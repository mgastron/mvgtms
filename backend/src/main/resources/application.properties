# Server Configuration
server.port=8080
server.address=0.0.0.0
spring.application.name=tms-backend

# Database Configuration
# Opción 1: H2 en archivo (persistente) - Recomendado para desarrollo
spring.datasource.url=jdbc:h2:file:./data/tmsdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# Opción 2: PostgreSQL (descomentar para usar PostgreSQL)
# spring.datasource.url=jdbc:postgresql://localhost:5432/tmsdb
# spring.datasource.username=postgres
# spring.datasource.password=postgres
# spring.datasource.driverClassName=org.postgresql.Driver

# JPA Configuration
# H2Dialect se detecta automáticamente, no es necesario especificarlo
# spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
# Para PostgreSQL, cambiar a: org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false

# Performance Optimizations
# Batch inserts/updates (mejora rendimiento para inserts masivos)
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# Connection Pool Configuration (HikariCP - default en Spring Boot)
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# Query Cache (opcional, requiere configuración adicional)
# spring.jpa.properties.hibernate.cache.use_query_cache=true
# spring.jpa.properties.hibernate.cache.use_second_level_cache=true

# SQL Initialization
# NOTA: Con ddl-auto=update, Spring Boot NO ejecuta data.sql automáticamente
# Los datos iniciales en data.sql solo se cargan en la primera ejecución si la base está vacía
# Para forzar la carga de data.sql, cambiar ddl-auto a "create" o "create-drop" (esto borrará datos existentes)
# Alternativamente, usar: spring.sql.init.mode=always (pero puede causar errores si los datos ya existen)
spring.sql.init.mode=always
spring.sql.init.continue-on-error=true

# H2 Console (for development)
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console

# Jackson Configuration (para deserialización de fechas ISO-8601)
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.deserialization.fail-on-unknown-properties=false

# Logging
logging.level.com.zetallegue.tms=DEBUG

# Configuración de logging a archivo
logging.file.name=logs/tms-backend.log
logging.file.max-size=50MB
logging.file.max-history=10
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n
logging.level.org.springframework.web=INFO

# MercadoLibre OAuth (valores reales en application-local.properties o variables de entorno en producción)
mercadolibre.client.id=your-mercadolibre-client-id
mercadolibre.client.secret=your-mercadolibre-client-secret
mercadolibre.redirect.uri=https://outcome-supreme-preview-invest.trycloudflare.com/auth/mercadolibre/callback
# URL base del frontend (se usa para generar links de vinculación)
# Si no se especifica, se extrae automáticamente de redirect.uri
# También se puede pasar como parámetro baseUrl en el endpoint
# frontend.base.url=https://shake-blake-calgary-generates.trycloudflare.com

# Tienda Nube OAuth (valores reales en application-local.properties o variables de entorno en producción)
tiendanube.client.id=your-tiendanube-client-id
tiendanube.client.secret=your-tiendanube-client-secret
tiendanube.redirect.uri=https://outcome-supreme-preview-invest.trycloudflare.com/auth/tiendanube/callback

# Email (valores reales en application-local.properties o variables de entorno en producción)
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=your-email@gmail.com
spring.mail.password=your-app-password
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000

# Frontend Base URL (para links de tracking en emails)
# Si no se especifica, se intentará usar la URL del redirect URI de MercadoLibre
# Ejemplo: https://istanbul-pledge-optical-disk.trycloudflare.com
frontend.base.url=https://outcome-supreme-preview-invest.trycloudflare.com

# Shopify OAuth Configuration (en producción usar variables de entorno SHOPIFY_CLIENT_ID y SHOPIFY_CLIENT_SECRET)
shopify.client.id=your-shopify-client-id
shopify.client.secret=your-shopify-client-secret
# Redirect URI - URL del backend donde se manejará el callback de OAuth
shopify.redirect.uri=https://blues-psychiatry-lightbox-then.trycloudflare.com/api/clientes/shopify/callback
